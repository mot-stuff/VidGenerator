{% from "_components.html" import collapsible %}

{% call collapsible('Brain Blender', open=False, subtitle='Generate your slop here') %}
{% set is_pro = (user.subscription_tier == 'pro') %}
<div class="content">
    <div id="userPlan" class="hidden" data-tier="{{ user.subscription_tier }}"></div>

    <div class="section">
        <h2>About</h2>
        <div class="wizard-hint">
            Brain Blender turns text into short-form videos with TTS + your background footage.
            Add text (single or batch), pick a background video (preset or upload), then generate and download from the queue.
        </div>
        <div class="wizard-hint">
            Downloads auto-expire, so grab completed jobs quickly.
        </div>
        <div class="wizard-hint">
            Upload/YouTube: connecting YouTube requires your own Google OAuth Client ID + Client Secret (we do not provide one).
        </div>
    </div>

    <div class="wizard-stepper" id="wizardStepper">
        <button class="wizard-step" type="button" data-step="1">1. Audio</button>
        <button class="wizard-step" type="button" data-step="2">2. Video</button>
        <button class="wizard-step" type="button" data-step="3">3. Generate</button>
        <button class="wizard-step {% if not is_pro %}locked{% endif %}" type="button" data-step="4" {% if not is_pro %}disabled{% endif %}>4. Upload {% if not is_pro %}ðŸ”’{% endif %}</button>
    </div>

    <div class="wizard-panel" id="step1Panel">
        <div class="section">
            <h2>Step 1: Audio</h2>

            <div class="wizard-row">
                <label class="wizard-radio">
                    <input type="radio" name="textMode" value="single" checked>
                    Single
                </label>
                <label class="wizard-radio">
                    <input type="radio" name="textMode" value="batch">
                    Batch
                </label>
            </div>

            <div id="singleTextSection">
                <div class="form-group">
                    <label for="textInput">Enter text</label>
                    <textarea id="textInput" placeholder="Type your text here..."></textarea>
                </div>
                <button class="btn btn-secondary" type="button" id="addToBatchBtn">Add to list</button>
            </div>

            <div id="batchSection" class="hidden">
                <div class="form-group">
                    <label for="csvFile">Upload CSV/TXT (one per line or first column)</label>
                    <input type="file" id="csvFile" accept=".csv,.txt">
                    <div id="csvInfo" class="file-info hidden"></div>
                </div>
            </div>

            <div class="wizard-list">
                <div class="wizard-list-header">
                    <div>Items</div>
                    <div class="wizard-list-meta"><span id="textCount">0</span></div>
                </div>
                <div id="textList" class="wizard-list-body"></div>
                <div class="wizard-list-actions">
                    <button class="btn btn-secondary" type="button" id="clearTextsBtn">Clear</button>
                </div>
            </div>

            <div class="section" style="margin-top: 14px;">
                <h2>Background music (optional)</h2>
                <div class="checkbox-group">
                    <input type="checkbox" id="bgMusicEnabled">
                    <label for="bgMusicEnabled" style="margin: 0;">Add background music</label>
                </div>

                <div id="bgMusicControls" class="hidden">
                    <div class="form-group">
                        <label for="bgMusicVolume">Music volume (<span id="bgMusicVolumeLabel">15%</span>)</label>
                        <input type="range" id="bgMusicVolume" min="0" max="40" step="1" value="15">
                        <div class="wizard-hint" style="margin-top: 8px;">
                            If you don't upload a track, a random track from the server library may be used (if configured).
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="bgMusicFile">Upload background music (mp3/wav/m4a)</label>
                        <input type="file" id="bgMusicFile" accept=".mp3,.wav,.m4a,.aac,.ogg,.flac">
                        <div id="bgMusicUploadProgress" class="progress hidden" aria-hidden="true">
                            <div id="bgMusicUploadProgressFill" class="progress-fill"></div>
                        </div>
                        <div id="bgMusicInfo" class="file-info hidden"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="wizard-panel hidden" id="step2Panel">
        <div class="section">
            <h2>Step 2: Background video(s)</h2>

            <div id="presetConfig"
                 class="hidden"
                 data-video1-path="{{ config.get('PRESET_VIDEO1_PATH', '') }}"
                 data-video2-path="{{ config.get('PRESET_VIDEO2_PATH', '') }}"
                 data-soap-path="{{ config.get('PRESET_SOAP_CUTTING_PATH', '') }}"></div>

            <div class="checkbox-group">
                <input type="checkbox" id="splitScreen">
                <label for="splitScreen">Split screen (2 videos)</label>
            </div>

            <div class="form-group" style="margin-top: 12px;">
                <label for="videoQuality">Quality / speed (<span id="videoQualityLabel">Balanced</span>)</label>
                <input type="range" id="videoQuality" min="0" max="100" step="1" value="50">
                <div class="wizard-hint">Lower = faster / smaller. Higher = slower / higher quality.</div>
            </div>

            <div class="video-section">
                <div class="video-upload">
                    <label for="video1">Video 1 <span id="video1Label"></span></label>

                    <div class="wizard-row" style="margin-bottom: 8px;">
                        <label class="wizard-radio">
                            <input type="radio" name="video1Source" value="preset">
                            Preset
                        </label>
                        <label class="wizard-radio">
                            <input type="radio" name="video1Source" value="upload" checked>
                            Upload
                        </label>
                    </div>

                    <div id="video1PresetRow" class="hidden" style="margin-bottom: 8px;">
                        <select id="video1PresetSelect" class="select">
                            <option value="minecraft_parkour">Minecraft Parkour</option>
                            <option value="soap_cutting">Soap Cutting</option>
                        </select>
                    </div>

                    <input type="file" id="video1" accept="video/*">
                    <div id="video1UploadProgress" class="progress hidden" aria-hidden="true">
                        <div id="video1UploadProgressFill" class="progress-fill"></div>
                    </div>
                    <div id="video1Info" class="file-info hidden"></div>
                </div>
                <div class="video-upload video2-section" id="video2Section">
                    <label for="video2">Video 2</label>

                    <div class="wizard-row" style="margin-bottom: 8px;">
                        <label class="wizard-radio">
                            <input type="radio" name="video2Source" value="preset">
                            Preset
                        </label>
                        <label class="wizard-radio">
                            <input type="radio" name="video2Source" value="upload" checked>
                            Upload
                        </label>
                    </div>

                    <div id="video2PresetRow" class="hidden" style="margin-bottom: 8px;">
                        <select id="video2PresetSelect" class="select">
                            <option value="minecraft_parkour">Minecraft Parkour</option>
                            <option value="soap_cutting">Soap Cutting</option>
                        </select>
                    </div>

                    <input type="file" id="video2" accept="video/*">
                    <div id="video2UploadProgress" class="progress hidden" aria-hidden="true">
                        <div id="video2UploadProgressFill" class="progress-fill"></div>
                    </div>
                    <div id="video2Info" class="file-info hidden"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="wizard-panel hidden" id="step3Panel">
        <div class="section">
            <h2>Step 3: Generate</h2>

            <div class="wizard-summary" id="wizardSummary"></div>

            <div class="wizard-actions">
                <button class="btn" type="button" id="generateBtn">Generate</button>
                <button class="btn btn-secondary" type="button" id="cancelAllJobsBtn">Stop jobs</button>
                <button class="btn btn-danger" type="button" id="clearJobsBtn">Clear queue</button>
            </div>

            <div class="wizard-row" style="margin-top: 10px;">
                <label class="wizard-checkbox">
                    <input type="checkbox" id="autoDownloadToggle">
                    Auto-download when complete (requires 1 click to enable in your browser)
                </label>
            </div>

            <div class="wizard-hint">
                Downloads expire quickly (auto-delete). Download as soon as a job is completed.
            </div>
        </div>

        <div class="section">
            <h2>Queue</h2>
            <div class="file-list" id="fileList">
                <div style="padding: 20px; text-align: center; color: #6b7280;">Loading recent jobs...</div>
            </div>
            <button class="btn btn-secondary" type="button" id="refreshJobsBtn">Refresh</button>
        </div>
    </div>

    <div class="wizard-panel hidden" id="step4Panel">
        <div class="section">
            <h2>Step 4: Upload</h2>

            {% if not is_pro %}
            <div class="wizard-hint">
                ðŸ”’ Available on the <strong>Pro</strong> plan only.
            </div>
            {% endif %}

            <div class="wizard-hint">
                YouTube upload requires OAuth (Client ID/Secret + one-time consent). API keys donâ€™t support uploads.
            </div>

            <div class="form-group" style="margin-top: 12px;">
                <label for="ytClientId">OAuth Client ID</label>
                <input type="text" id="ytClientId" placeholder="xxxx.apps.googleusercontent.com" {% if not is_pro %}disabled{% endif %}>
            </div>

            <div class="form-group">
                <label for="ytClientSecret">OAuth Client Secret</label>
                <input type="text" id="ytClientSecret" placeholder="GOCSPX-..." {% if not is_pro %}disabled{% endif %}>
            </div>

            <div class="wizard-actions">
                <button class="btn btn-secondary" type="button" id="ytSaveCredsBtn" {% if not is_pro %}disabled{% endif %}>Save credentials</button>
                <button class="btn" type="button" id="ytConnectBtn" {% if not is_pro %}disabled{% endif %}>Connect YouTube</button>
            </div>

            <div class="checkbox-group" style="margin-top: 12px;">
                <input type="checkbox" id="ytAutoUpload" {% if not is_pro %}disabled{% endif %}>
                <label for="ytAutoUpload" style="margin: 0;">Auto-upload completed videos</label>
            </div>

            <div id="ytStatusInfo" class="file-info hidden"></div>
        </div>
    </div>
</div>

<div class="status-bar">
    <div class="status-indicator">
        <div class="status-dot"></div>
        <span id="statusText">Ready to generate videos</span>
    </div>
    <div class="controls">
        <button class="btn btn-secondary" type="button" id="backBtn">Back</button>
        <button class="btn" type="button" id="nextBtn">Next</button>
    </div>
</div>
{% endcall %}


